(function(a){var b=function(){return new c};var c=function(a){this.$context=a||{error:null,actions:[],vars:{}}};c.prototype.seq=function(a,b){if(a instanceof Function){b=a;a=null}if(!b){throw"Sequence action not defined"}var c=this;this.$context.actions.push(function(d){var e=function(b,e){if(!b&&a){c.$context.vars[a]=e}d(b,e)};e.vars=c.$context.vars;if(b.length){b.call(e,e)}else{try{e(null,b.call(e))}catch(f){e(f,null)}}});return this};var d=function(a,b){if(!b){throw"Parallel action not defined"}return function(c,d,e,f){var g=function(b,d){if(!b&&a){e[a]=d}f(c,b,d)};g.vars=d.vars;if(b.length){b.call(g,g)}else{try{g(null,b.call(g))}catch(h){g(h,null)}}}};c.prototype.par=function(a){var b=this;if(a){var c=[];if(a instanceof Array){for(var e=0;e<a.length;e++){var f=a[e];c.push(new d(null,f))}}else{for(var g in a){if(a.hasOwnProperty(g)){c.push(new d(g,a[g]))}}}if(c.length>0){this.$context.actions.push(function(a){(function(a,c){var d={};var e=function(e,f,g){if(f){c(f,null)}else{var h=a.indexOf(e);if(h>=0&&h<a.length){a.splice(h,1)}else{c("Parallel function returned which wasn't part of this parallel actions");return}if(a.length==0){for(var i in d){if(d.hasOwnProperty(i)){b.$context.vars[i]=d[i]}}c(null,d)}}};var f=a.slice();for(var g=0;g<f.length;g++){var h=f[g];h(h,b.$context,d,e)}})(c,a)})}}return this};c.prototype.exec=function(a){function d(a){if(a<b.$context.actions.length){b.$context.actions[a](function(e,f){if(e){c(e,b.$context.vars)}else{d(a+1)}})}else{c(null,b.$context.vars)}}var b=this;var c=function(b,c){if(a){a(b,c)}};d(0)};var e=this,f=e.flow;b.noConflict=function(){e.flow=f;return b};a.flow=b})(typeof exports==="undefined"?this:exports)